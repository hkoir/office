{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}

<div class="card shadow-sm my-5">
  <div class="card-header bg-primary text-white text-center">
    <h5 class="mb-0">Office Management Actions</h5>
  </div>
  <div class="card-body text-center d-flex flex-wrap justify-content-center gap-2">


    <a href="{% url 'officemanagement:office_expense_advance' %}" 
       class="btn btn-info btn-sm">
       <i class="fas fa-money-bill-wave"></i> Expense / Advance
    </a>

    <a href="{% url 'officemanagement:office_meeting_room_booking' %}" 
       class="btn btn-warning btn-sm text-white">
       <i class="fas fa-handshake"></i> Meeting Room Booking
    </a>

    <a href="{% url 'officemanagement:office_visitor_management' %}" 
       class="btn btn-secondary btn-sm">
       <i class="fas fa-user-friends"></i> Visitor Management
    </a>

    <a href="{% url 'officemanagement:office_documentations' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Documentations
    </a>

       <a href="{% url 'officemanagement:office_supplies_stationary' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Office Supplies & Stationary
    </a>

    <a href="{% url 'officemanagement:office_it_support_ticket' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> IT support
    </a>

    <a href="{% url 'officemanagement:inventory_report' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Inventory Report
    </a>

    <a href="{% url 'officemanagement:visitor_reports' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Visitor Report
    </a>

    <a href="{% url 'officemanagement:meeting_room_report' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Meeting room report
    </a>

    <a href="{% url 'officemanagement:advance_reconcilation_report' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Advance reconcilation report
    </a>
    <a href="{% url 'officemanagement:top_expense_categories' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> top expense categories
    </a>

  </div>
</div>


    <h2 class="mb-4 text-center">Meeting Room Report</h2>
    <h3>Total Meeting Rooms:&nbsp;{{  total_Number_of_meeting_rooms }}</h3>



    <div class="row">
        <div class="col-md-9">           
            <canvas id="meetingRoomBarChart" height="80%"></canvas>
        </div>
        <div class="col-md-3">          
            <canvas id="meetingRoomPieChart" width="40%"></canvas>
        </div>
    </div>


    <!-- Rooms Currently in Use -->
    <h4 class="text-danger">Rooms Currently in Use</h4>

    <div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead class="table-danger">
            <tr>
                <th>#</th>
                <th>Room Name</th>
                <th>Capacity</th>
                <th>Location</th>
            </tr>
        </thead>
        <tbody>
            {% for room in in_use_rooms %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ room.name }}</td>
                    <td>{{ room.capacity }}</td>
                    <td>{{ room.location|default:"N/A" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No rooms are currently in use.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>

    <!-- Rooms That Will Be Free in 30 Minutes -->
    <h4 class="text-success mt-4">Rooms That Will Be Free in 30 Minutes</h4>
    <table class="table table-bordered table-striped">
        <thead class="table-success">
            <tr>
                <th>#</th>
                <th>Room Name</th>
                <th>Capacity</th>
                <th>Location</th>
                <th>Book This room ?</th>
            </tr>
        </thead>
        <tbody>
            {% for room in free_soon_rooms %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ room.name }}</td>
                    <td>{{ room.capacity }}</td>
                    <td>{{ room.location|default:"N/A" }}</td>
                    <td><a  href="{% url 'officemanagement:book_meeting_room' room.id %}">Book Now</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No rooms will be free in the next 30 minutes.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>



    <script>
        document.addEventListener("DOMContentLoaded", function () {            
            let totalRooms = JSON.parse('{{ total_Number_of_meeting_rooms|safe }}');
            let inUseRooms = JSON.parse('{{ in_use_rooms|length|safe }}');
            let freeSoonRooms = JSON.parse('{{ free_soon_rooms|length|safe }}');

            let colors = ['#FF6384', '#36A2EB', '#FFCE56'];

            // Bar Chart
            let barCtx = document.getElementById('meetingRoomBarChart').getContext('2d');
            new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Meeting Rooms'], // Single group label
                    datasets: [
                        {
                            label: 'Total Rooms',
                            data: [totalRooms],
                            backgroundColor: colors[0]
                        },
                        {
                            label: 'In Use Rooms',
                            data: [inUseRooms],
                            backgroundColor: colors[1]
                        },
                        {
                            label: 'Free Soon Rooms',
                            data: [freeSoonRooms],
                            backgroundColor: colors[2]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
                        });

            // Pie Chart
            let pieCtx = document.getElementById('meetingRoomPieChart').getContext('2d');
            new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: ['In Use Rooms', 'Free Soon Rooms'],
                    datasets: [{
                        data: [inUseRooms, freeSoonRooms],
                        backgroundColor: colors.slice(1)
                    }]
                },
                options: {
                    responsive: true
                }
            });
        });
    </script>


{% endblock %}