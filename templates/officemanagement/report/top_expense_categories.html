{% extends "base.html" %}
{% load custom_filters %}

{% block content %}

<div class="card shadow-sm my-5">
  <div class="card-header bg-primary text-white text-center">
    <h5 class="mb-0">Office Management Actions</h5>
  </div>
  <div class="card-body text-center d-flex flex-wrap justify-content-center gap-2">


    <a href="{% url 'officemanagement:office_expense_advance' %}" 
       class="btn btn-info btn-sm">
       <i class="fas fa-money-bill-wave"></i> Expense / Advance
    </a>

    <a href="{% url 'officemanagement:office_meeting_room_booking' %}" 
       class="btn btn-warning btn-sm text-white">
       <i class="fas fa-handshake"></i> Meeting Room Booking
    </a>

    <a href="{% url 'officemanagement:office_visitor_management' %}" 
       class="btn btn-secondary btn-sm">
       <i class="fas fa-user-friends"></i> Visitor Management
    </a>

    <a href="{% url 'officemanagement:office_documentations' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Documentations
    </a>

       <a href="{% url 'officemanagement:office_supplies_stationary' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Office Supplies & Stationary
    </a>

    <a href="{% url 'officemanagement:office_it_support_ticket' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> IT support
    </a>

    <a href="{% url 'officemanagement:inventory_report' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Inventory Report
    </a>

    <a href="{% url 'officemanagement:visitor_reports' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Visitor Report
    </a>

    <a href="{% url 'officemanagement:meeting_room_report' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Meeting room report
    </a>

    <a href="{% url 'officemanagement:advance_reconcilation_report' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Advance reconcilation report
    </a>
    <a href="{% url 'officemanagement:top_expense_categories' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> top expense categories
    </a>

  </div>
</div>
<div class="container-fluid main-content">
    <form method="GET" action="{% url 'officemanagement:top_expense_categories' %}"
    class="mb-3">
        <label for="start_date">Start Date:</label>
        <input type="date" name="start_date" id="start_date" value="{{ start_date }}" class="form-control">
    
        <label for="end_date">End Date:</label>
        <input type="date" name="end_date" id="end_date" value="{{ end_date }}"class="form-control">
    
        <button class="btn btn-primary form-control" type="submit">Filter</button>
    </form>

    <div class="row my-4">
        <h2>Top 5 Frequent Expense Categories</h2>
        <div class="col-12 col-md-4 table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Category</th>
                        <th>Total Spent</th>
                        <th>Number of Transactions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_categories %}
                    <tr>
                        <td>{{ item.category }}</td>
                        <td>${{ item.total_spent }}</td>
                        <td>{{ item.count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-12 col-md-8">
            <canvas id="expenseChart" width="600" height="300"></canvas>
        </div>
    </div>
</div>

   
  

   


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var categories = JSON.parse('{{ top_categories_json|safe }}');
   
        var labels = categories.map(item => item.category);
        var amounts = categories.map(item => parseFloat(item.total_spent)); 

        var ctx = document.getElementById("expenseChart").getContext("2d");

        new Chart(ctx, {
            type: "bar", 
            data: {
                labels: labels,
                datasets: [{
                    label: "Total Spent",
                    data: amounts,
                    backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: false,
                plugins: {
                    legend: { position: "top" },
                    title: { display: true, text: "Top 5 Frequent Expense Categories" }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    });
</script>

{% endblock %}
