{% extends "base.html" %}
{% load custom_filters %}

{% block content %}

<div class="container-fluid main-content">
    <form method="GET" action="{% url 'officemanagement:top_expense_categories' %}"
    class="mb-3">
        <label for="start_date">Start Date:</label>
        <input type="date" name="start_date" id="start_date" value="{{ start_date }}" class="form-control">
    
        <label for="end_date">End Date:</label>
        <input type="date" name="end_date" id="end_date" value="{{ end_date }}"class="form-control">
    
        <button class="btn btn-primary form-control" type="submit">Filter</button>
    </form>

    <div class="row my-4">
        <h2>Top 5 Frequent Expense Categories</h2>
        <div class="col-12 col-md-4 table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Category</th>
                        <th>Total Spent</th>
                        <th>Number of Transactions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_categories %}
                    <tr>
                        <td>{{ item.category }}</td>
                        <td>${{ item.total_spent }}</td>
                        <td>{{ item.count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-12 col-md-8">
            <canvas id="expenseChart" width="600" height="300"></canvas>
        </div>
    </div>
</div>

   
  

   


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var categories = JSON.parse('{{ top_categories_json|safe }}');
   
        var labels = categories.map(item => item.category);
        var amounts = categories.map(item => parseFloat(item.total_spent)); 

        var ctx = document.getElementById("expenseChart").getContext("2d");

        new Chart(ctx, {
            type: "bar", 
            data: {
                labels: labels,
                datasets: [{
                    label: "Total Spent",
                    data: amounts,
                    backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF"],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: false,
                plugins: {
                    legend: { position: "top" },
                    title: { display: true, text: "Top 5 Frequent Expense Categories" }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    });
</script>

{% endblock %}
