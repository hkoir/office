{% extends 'base.html' %}
{% block content %}

<div class="d-flex flex-wrap justify-content-start gap-2 mb-3" style="border-bottom: 2px solid #f1f1f1; padding-bottom: 10px;">

  <a href="{% url 'officemanagement:create_visitor_group' %}" class="btn btn-primary btn-sm">
    <i class="fas fa-users"></i> Create Visitor Group
  </a>

  <a href="{% url 'officemanagement:create_visitor_member' %}" class="btn btn-success btn-sm">
    <i class="fas fa-user-plus"></i> Add Visitor Member
  </a>

  <a href="{% url 'officemanagement:visitor_group_check_in' %}" class="btn btn-info btn-sm">
    <i class="fas fa-sign-in-alt"></i> Group Check-In
  </a>

  <a href="{% url 'officemanagement:visitor_log_list' %}" class="btn btn-secondary btn-sm">
    <i class="fas fa-list"></i> Visitor Log List
  </a>

  <a href="{% url 'officemanagement:visitor_id_card_list' %}" class="btn btn-dark btn-sm">
    <i class="fas fa-id-card"></i> Visitor ID Cards
  </a>

  <a href="{% url 'officemanagement:generate_visitor_id_cards' %}" class="btn btn-warning btn-sm">
    <i class="fas fa-print"></i> Generate ID Cards
  </a>

  <a href="{% url 'officemanagement:search_visitor' %}" class="btn btn-outline-primary btn-sm">
    <i class="fas fa-search"></i> Search Visitor
  </a>

  <a href="{% url 'officemanagement:visitor_report' %}" class="btn btn-outline-success btn-sm">
    <i class="fas fa-chart-line"></i> Visitor Report
  </a>
</div>



<div class="card shadow-sm my-5">
  <div class="card-header bg-primary text-white text-center">
    <h5 class="mb-0">Office Management Actions</h5>
  </div>
  <div class="card-body text-center d-flex flex-wrap justify-content-center gap-2">


    <a href="{% url 'officemanagement:office_expense_advance' %}" 
       class="btn btn-info btn-sm">
       <i class="fas fa-money-bill-wave"></i> Expense / Advance
    </a>

    <a href="{% url 'officemanagement:office_meeting_room_booking' %}" 
       class="btn btn-warning btn-sm text-white">
       <i class="fas fa-handshake"></i> Meeting Room Booking
    </a>

    <a href="{% url 'officemanagement:office_visitor_management' %}" 
       class="btn btn-secondary btn-sm">
       <i class="fas fa-user-friends"></i> Visitor Management
    </a>

    <a href="{% url 'officemanagement:office_documentations' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Documentations
    </a>

       <a href="{% url 'officemanagement:office_supplies_stationary' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> Office Supplies & Stationary
    </a>

        <a href="{% url 'officemanagement:office_it_support_ticket' %}" 
       class="btn btn-dark btn-sm">
       <i class="fas fa-file-alt"></i> IT support
    </a>

  </div>
</div>


<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <h2>Currently Checked-in Visitors</h2>
    <form method="get" class="d-flex ms-auto mt-2 mt-md-0" style="min-width: 450px;">
        <input type="text"
               name="q"
               value="{{ query }}"
               placeholder="Name or company or card..."
               class="form-control me-2 flex-grow-1"
               style="min-width: 300px;">
        <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>

    <p class="text-muted">Only visitors who haven't checked out yet.</p>

<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>Name</th>
         <th>Photo ID</th>
        <th>Company</th>
        <th>Visitor Type</th>
        <th>Phone</th>
        <th>ID Card</th>
        <th>Check-In</th>
        <th>Check-Out</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for visitor in visitors %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ visitor.name }}</td>
        <td>
         <td>
          {% if visitor.photo %}
            <a href="{{ visitor.photo.url }}" target="_blank">
              <img src="{{ visitor.photo.url }}" alt="{{ visitor.name }}" width="40" height="40" class="img-thumbnail">
            </a>
          {% else %}
            <span class="text-muted">No photo</span>
          {% endif %}
        </td>
        </td>
        <td>{{ visitor.company.company }}</td>
        <td>{{ visitor.visitor_type|title }}</td>
        <td>{{ visitor.phone }}</td>
        <td>
          {% if visitor.id_card %}
            {{ visitor.id_card.card_number }}
            {% if visitor.id_card.qr_code %}
              <img src="{{ visitor.id_card.qr_code.url }}" alt="QR" width="40" class="ms-2 rounded">
            {% endif %}
          {% else %}
            <span class="text-muted">Not assigned</span>
          {% endif %}
        </td>
        <td>{{ visitor.check_in|date:"Y-m-d H:i" }}</td>
        <td>{{ visitor.check_out|date:"Y-m-d H:i" }}</td>
        <td>
          {% if not visitor.id_card %}
            <a href="{% url 'officemanagement:visitor_check_in' visitor.id %}" class="btn btn-sm btn-outline-primary">Check in</a>
          {% elif not visitor.check_out %}
            <a href="{% url 'officemanagement:visitor_check_out' visitor.id %}" class="btn btn-sm btn-outline-danger">Check Out</a>
          {% else %}
            <span class="badge bg-success">Completed</span>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="9" class="text-center text-muted">No visitor records found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
</div>
{% endblock %}
