{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block content %}


<div class="container-fluid">
<div class="container-fluid main-content py-4">
  <div class="row g-2 justify-content-center text-center">
    <div class="col-auto">
      <a href="{% url 'purchase:create_purchase_request' %}" class="btn btn-sm btn-success">Request for Purchase</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'purchase:purchase_request_order_list' %}" class="btn btn-sm btn-success">Request Order List</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'purchase:rfq_list' %}" class="btn btn-sm btn-success">RFQ List</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'purchase:supplier_quotation_list' %}" class="btn btn-sm btn-success">Supplier Quotation List</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'purchase:purchase_order_list' %}" class="btn btn-sm btn-success">Purchase Order List</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'purchase:create_batch' %}" class="btn btn-sm btn-success">Create Batch</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'logistics:purchase_shipment_list' %}" class="btn btn-sm btn-success">Purchase Shipment</a>
    </div>
    <div class="col-auto">
      <a href="{% url 'purchase:batch_list' %}" class="btn btn-sm btn-success">Batch List</a>
    </div>
       <div class="col-auto">
        <a href="{% url 'finance:purchase_invoice_list' %}" class="btn btn-sm btn-success">Purchase Invoice List</a>
        </div>
         <div class="col-auto">
        <a href="{% url 'finance:sale_invoice_list' %}" class="btn btn-sm btn-success">Sale Invoice List</a>
        </div>
  </div>
</div>


    <div class="row">
        <h2 class="text-center">Supplier Quotation Comparison for RFQ {{ rfq.id }}</h2>
        <!-- Overall Supplier Comparison -->
        <h3 class="mt-4">Overall Supplier Totals</h3>
        <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Supplier</th>
                    <th>Quotation #</th>
                    <th>Total Amount</th>
                    <th>AIT Status</th>
                    <th>AIT Rate</th>
                    <th>Net Payable after vat</th>
                </tr>
            </thead>
            <tbody>
                {% for s in comparison_data.suppliers %}
                <tr {% if comparison.lowest_supplier and s.supplier.id == comparison.lowest_supplier.supplier.id %} 
                        style="background-color:#d4edda;" 
                    {% endif %}>
                    <td>{{ s.supplier.name }}</td>
                    <td>{{ s.quotation_number }}</td>
                    <td>{{ s.total_amount }}</td>
                    <td>{{ s.AIT_type }}</td>
                    <td>{{ s.AIT_rate }}&nbsp;%</td>
                    <td>{{ s.net_payable }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

        <!-- Detailed Item-Level Comparison -->
         <div class="table-responsive">
        <h3>Item-Level Comparison</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Supplier</th>
                    <th>Quotation #</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Total Price</th>
                    <th>VAT Status</th>
                    <th>VAT rate</th>
                   
                </tr>
            </thead>
            <tbody>
                {% for product_id, data in comparison_data.items.items %}
                    {% for q in data.quotations %}
                    <tr>
                        {% if forloop.first %}
                        <td rowspan="{{ data.quotations|length }}">{{ data.product.name }}</td>
                        {% endif %}
                        <td>{{ q.supplier.name }}</td>
                        <td>{{ q.quotation_number }}</td>
                        <td>{{ q.quantity }}</td>
                        <td {% if q.unit_price == data.lowest_price %} style="background-color: #d4edda;" {% endif %}>
                            {{ q.unit_price }}
                        </td>
                        <td>{{ q.total_price }}</td>
                        <td>{{ q.VAT_type }}</td>
                        <td>{{ q.VAT_rate }}&nbsp;%</td>
                       
                    </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
        </div>

    </div>
</div>
{% endblock %}