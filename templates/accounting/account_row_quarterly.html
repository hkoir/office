{% load custom_filters %}
<tr 
    {% if node.parent_id %} 
        class="collapse child-of-{{ node.parent_id }}" 
    {% endif %}
>
    <!-- Code -->
    <td>{{ node.account.code }}</td>

    <!-- Account Name -->
    <td class="account-name level-{{ node.level|default:0 }}">
        {% if node.children %}
            <i class="fas fa-chevron-right me-1 toggle-icon"
               data-bs-toggle="collapse"
               data-bs-target=".child-of-{{ node.account.id }}"></i>
        {% endif %}
        <a href="{% url 'accounting:ledger' node.account.id %}">{{ node.account.name }}</a>
    </td>

    <!-- Balances per quarter -->
    {% for fy in fiscal_years %}
        {% for q in quarters %}
            {% with key=fy.id|stringformat:"s"|add:"_"|add:q %}
                <td class="text-end">{{ node.balances|dict_get:key|floatformat:2 }}</td>
            {% endwith %}
        {% endfor %}
    {% endfor %}
</tr>

{% if node.children %}
    {% for child in node.children %}
        {% include "accounting/account_row_quarterly.html" with node=child fiscal_years=fiscal_years quarters=quarters %}
    {% endfor %}
{% endif %}
