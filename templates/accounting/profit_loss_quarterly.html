{% extends "../base.html" %}
{% load custom_filters %}

{% block content %}

<style>
.level-0 { padding-left: 0px; }
.level-1 { padding-left: 20px; }
.level-2 { padding-left: 40px; }
.level-3 { padding-left: 60px; }
/* Add more levels if needed */
</style>


<div class="container">
    <div class="container-fluid main-content py-4">
      <div class="row g-2 justify-content-center text-center">
        <div class="col-auto">
          <a href="{% url 'accounting:balance_sheet' %}" class="btn btn-sm btn-primary w-100">
            Balance Sheet
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:balance_sheet_quarterly' %}" class="btn btn-sm btn-primary w-100">
            Balance Sheet Quarterly
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:trial_balance' %}" class="btn btn-sm btn-primary w-100">
            Trial Balance
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:profit_loss' %}" class="btn btn-sm btn-primary w-100">
            Profit &amp; Loss
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:profit_loss_quarterly' %}" class="btn btn-sm btn-primary w-100">
            Profit &amp; Loss Quarterly
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:journalentry_create' %}" class="btn btn-sm btn-primary w-100">
            Journal Entry
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:journalentry_list' %}" class="btn btn-sm btn-primary w-100">
            Journal Entry List
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:account_create' %}" class="btn btn-sm btn-primary w-100">
            Add Account
          </a>
        </div>
        <div class="col-auto">
          <a href="{% url 'accounting:account_list' %}" class="btn btn-sm btn-primary w-100">
            Account List
          </a>
        </div>
      </div>
    </div>





<h2 class="mt-4 text-center">Profit & Loss Report (Quarterly)</h2>
<div class="table-responsive">
<table class="table table-bordered table-striped table-sm">
    <thead class="table-dark">
        <tr>
            <th>Account code</th>
            <th>Account</th>
            {% for fy in fiscal_years %}
                {% for q in quarters %}
                    <th class="text-end">{{ fy.year_start.year }} {{ q }}</th>
                {% endfor %}
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        <!-- Income Section -->
        <tr class="table-secondary">
            <td colspan="{{ total_cols }}"><strong>Income</strong></td>
        </tr>
        {% for node in report_income %}
            {% include "accounting/account_row_quarterly_pl.html" with node=node fiscal_years=fiscal_years quarters=quarters %}
        {% endfor %}

        <!-- Total Income -->
        <tr class="fw-bold table-dark">
            <td colspan="2" class="text-end">Total Income</td>
            {% for fy in fiscal_years %}
                {% for q in quarters %}
                    <td class="text-end">{{ totals|dict_get:fy.id|dict_get:q|dict_get:"income"|floatformat:2 }}</td>
                {% endfor %}
            {% endfor %}
        </tr>

        <!-- Expenses Section -->
        <tr class="table-secondary">
            <td colspan="{{ total_cols }}"><strong>Expenses</strong></td>
        </tr>
        {% for node in report_expenses %}
            {% include "accounting/account_row_quarterly_pl.html" with node=node fiscal_years=fiscal_years quarters=quarters %}
        {% endfor %}

        <!-- Total Expenses -->
        <tr class="fw-bold table-dark">
            <td colspan="2" class="text-end">Total Expenses</td>
            {% for fy in fiscal_years %}
                {% for q in quarters %}
                    <td class="text-end">{{ totals|dict_get:fy.id|dict_get:q|dict_get:"expenses"|floatformat:2 }}</td>
                {% endfor %}
            {% endfor %}
        </tr>

        <!-- Net Profit Before Tax -->
        <tr class="fw-bold table-success">
            <td colspan="2" class="text-end">Net Profit Before Tax</td>
            {% for fy in fiscal_years %}
                {% for q in quarters %}
                    <td class="text-end">{{ totals|dict_get:fy.id|dict_get:q|dict_get:"net_profit_before_tax"|floatformat:2 }}</td>
                {% endfor %}
            {% endfor %}
        </tr>

        <!-- Tax -->
        <tr class="fw-bold table-warning">
            <td colspan="2" class="text-end">Tax ({{ tax_rate|floatformat:2 }})</td>
            {% for fy in fiscal_years %}
                {% for q in quarters %}
                    <td class="text-end">{{ totals|dict_get:fy.id|dict_get:q|dict_get:"tax"|floatformat:2 }}</td>
                {% endfor %}
            {% endfor %}
        </tr>

        <!-- Net Profit After Tax -->
        <tr class="fw-bold table-success">
            <td colspan="2" class="text-end">Net Profit After Tax</td>
            {% for fy in fiscal_years %}
                {% for q in quarters %}
                    <td class="text-end">{{ totals|dict_get:fy.id|dict_get:q|dict_get:"net_profit_after_tax"|floatformat:2 }}</td>
                {% endfor %}
            {% endfor %}
        </tr>
    </tbody>
  </table>
</div>



</div>


<!-- Optional JS for collapsible rows -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggles = document.querySelectorAll('.toggle-icon');
    toggles.forEach(icon => {
        icon.addEventListener('click', function() {
            const targetClass = icon.getAttribute('data-bs-target').substring(1);
            document.querySelectorAll(targetClass).forEach(row => row.classList.toggle('show'));
            icon.classList.toggle('fa-chevron-right');
            icon.classList.toggle('fa-chevron-down');
        });
    });
});
</script>

{% endblock %}
